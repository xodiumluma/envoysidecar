# Bazel build & test configuration for Envoy
# 200Mb RAM is quite sufficient for local builds; see this:
# https://docs.bazel.build/versions/master/skylark/performance.html#memory-profiling
# For a large host, all the allocated working memory specified by a cgroup could be used up as the default heap memory size in the JVM is a quarter of actual RAM, up to a 32Gb ceiling
# To make space for the compiler/linker, we put a cap on the heap size (so GC can occur and thus make space)
# We choose 3Gb to anticipate large VMs and small VMs with RBE
# Can't select startup options via config
startup --host_jvm_args=-Xmx3g

run --color=yes

build --color=yes
build --workspace_status_command="bash bazel/get_workspace_status"
build --incompatible_strict_action_env
build --host_force_python=PY3
build --java_runtime_version=remotejdk_11
build --tool_java_runtime_version=remotejdk_11
build --platform_mappings=bazel/platform_mappings

# turn off absl verbose logging
build --copt=-DABSL_MIN_LOG_LEVEL=4

# capture environment varibales 
build --action_env=CC --host_action_env=CC
build --action_env=CXX --host_action_env=CXX
build --action_env=LLVM_CONFIG --host_action_env=LLVM_CONFIG
build --action_env=PATH --host_action_env=PATH

build --enable_platform_specific_config
build --test_summary=terse
